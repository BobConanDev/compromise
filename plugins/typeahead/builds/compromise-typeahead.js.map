{"version":3,"file":"compromise-typeahead.js","sources":["../src/tryPrefix.js","../src/getPrefixes.js","../src/index.js"],"sourcesContent":["const tryPrefix = function (doc, lex) {\n  let world = doc.world\n  world.prefixes = world.prefixes || {}\n  // get end-part of text\n  let end = doc.last()\n  let m = end.terms().last()\n  let json = m.json({ terms: { normal: true } })\n  if (!json[0] || !json[0].terms) {\n    return\n  }\n  json = json[0].terms[0]\n  // if we've already put whitespace, end.\n  if (json.post) {\n    return\n  }\n  // if we found something\n  if (world.prefixes.hasOwnProperty(json.normal)) {\n    let found = world.prefixes[json.normal]\n    // add full-word as an implicit result\n    m.termList()[0].implicit = found\n    m.termList()[0].typeAhead = true\n    // tag it too?\n    if (lex.hasOwnProperty(found)) {\n      m.tag(lex[found], 'typeahead')\n    }\n  }\n}\nmodule.exports = tryPrefix\n","// generate all the possible prefixes up-front\nconst createIndex = function (arr, opts, world) {\n  let index = {}\n  let collisions = []\n  let existing = world.prefixes || {}\n  arr.forEach((str) => {\n    str = str.toLowerCase().trim()\n    let max = str.length\n    if (opts.max && max > opts.max) {\n      max = opts.max\n    }\n    for (let size = opts.min; size < max; size += 1) {\n      let prefix = str.substr(0, size)\n      // ensure prefix is not a word\n      if (opts.safe && world.words.hasOwnProperty(prefix)) {\n        continue\n      }\n      // does it already exist?\n      if (existing.hasOwnProperty(prefix) === true) {\n        collisions.push(prefix)\n        continue\n      }\n      if (index.hasOwnProperty(prefix) === true) {\n        collisions.push(prefix)\n        continue\n      }\n      index[prefix] = str\n    }\n  })\n  // merge with existing prefixes\n  index = Object.assign({}, existing, index)\n  // remove ambiguous-prefixes\n  collisions.forEach((str) => {\n    delete index[str]\n  })\n  return index\n}\nmodule.exports = createIndex\n","const tryPrefix = require('./tryPrefix')\nconst getPrefixes = require('./getPrefixes')\n\nconst isObject = function (obj) {\n  return obj && Object.prototype.toString.call(obj) === '[object Object]'\n}\n\nconst defaults = {\n  safe: true,\n  min: 3,\n}\n\nconst plugin = function (Doc, world, _nlp) {\n  /** add words that can be predicted from their prefix */\n  _nlp.typeahead = function (arr = [], opts = {}) {\n    let lex = {}\n    opts = Object.assign({}, defaults, opts)\n    // wiggle-out our params\n    if (isObject(arr)) {\n      lex = arr\n      arr = Object.keys(lex)\n    }\n    // pre-compute all prefixes\n    world.prefixes = getPrefixes(arr, opts, world)\n    // each keypress, try the end\n    world.postProcess((doc) => {\n      tryPrefix(doc, lex)\n    })\n  }\n  //assume the typeahead as a full-word\n  Doc.prototype.autoFill = function () {\n    this.termList().forEach((t) => {\n      if (t.typeAhead === true && t.implicit) {\n        t.text = t.implicit\n        t.implicit = null\n        t.typeAhead = undefined\n      }\n    })\n  }\n\n  // alias\n  _nlp.typeAhead = Doc.prototype.typeahead\n}\nmodule.exports = plugin\n"],"names":["tryPrefix","doc","lex","world","prefixes","end","last","m","terms","json","normal","post","hasOwnProperty","found","termList","implicit","typeAhead","tag","createIndex","arr","opts","index","collisions","existing","forEach","str","toLowerCase","trim","max","length","size","min","prefix","substr","safe","words","push","Object","assign","isObject","obj","prototype","toString","call","defaults","plugin","Doc","_nlp","typeahead","keys","getPrefixes","postProcess","autoFill","t","text","undefined"],"mappings":"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"}